<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	var xhr=null;
	function ajaxRequestIdCheck(){
		//var idStr=document.f.id.value;
		var idStr=document.getElementById("id").value;
		if(idStr.length!=0 && idStr.trim()==""){
			document.getElementById("msg").innerHTML='<b>전송할아이디를입력하세요</b>'
			//document.getElementById("id").value='';
			document.getElementById("id").focus();
			document.getElementById("msg").style.border="none";
			document.getElementById("msg").style.color="black";
			return;
		}else if(idStr.length==0 && idStr=="" ){
			document.getElementById("msg").innerHTML='';
			document.getElementById("msg").style.border="none";
			document.getElementById("msg").style.color="black";
			return;
		}
		
		//<< AJAX 요청 순서 >>
		/*
			1. XMLHttpRequest객체생성
		*/
		xhr=new XMLHttpRequest();
		/*
		    2. 요청설정
		*/
		var params = "id="+idStr;
		var method='GET';
		var url='02.ajaxRequest.jsp'+"?"+params;
		var async=true;
		xhr.open(method, url, async);
		/*
			응답이도착했을때 실행되는 콜백함수등록
		*/
		xhr.onreadystatechange=responseCallBack;
		
		/*
	    	3. 요청
		*/
		xhr.send(null);
		
	}
	/*
	응답이도착했을때 실행되는 콜백함수
	*/
	function responseCallBack(){
		/*
		this == XMLHttpRequest
		*/
		/*
		<< xhr.readyState >>
		The state of the request. 
		 0=unsent
		 1=opened
		 2=headers_received
		 3=loading
		 4=done
		*/
		console.log(xhr.readyState);
		if(xhr.readyState==4){
			//완전한응답이도착했을때
			var responseText = xhr.responseText;
			if(responseText.trim()=='Y'){
				document.getElementById("msg").innerHTML='사용가능';
				document.getElementById("msg").style.border="1px solid blue";
				document.getElementById("msg").style.color="blue";
			}else if(responseText.trim()=='N'){
				document.getElementById("msg").innerHTML='사용불가능';
				document.getElementById("msg").style.border="1px solid red";
				document.getElementById("msg").style.color="red";
			}
		}else{
			
			//document.getElementById("msg").innerHTML='loading...';
			document.getElementById("msg").style.border="none";
			document.getElementById("msg").style.color="black";
			document.getElementById("msg").innerHTML=
				"<img width='15' height='15' src='loading.gif'/>";
			
		}		
	}
	
</script>
</head>
<body>
<h1>ajax 요청</h1><hr/>
<form name="f" id="f">
	아이디:<input type="text" name="id" id="id"  
		onkeyup="ajaxRequestIdCheck();">
	<span id="msg"></span>
</form>
</body>
</html>





